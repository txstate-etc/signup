<% if authorized?(session) && !session.new_record? && session.time && session.time > Time.now && !session.cancelled %>
	<%= javascript_include_tag 'modal' %>
	<div id="cancel-session-dialog" class="content-section" style="display:none">
		<h2>Cancel Session</h2>
		<p class="cancel-session-confirm">
			Are you sure you want to cancel this class? All registered attendees will be notified that the session has been cancelled.
		</p>

		<h3>Message to Attendees</h3>
		<p class="cancel-session-instructions">
			The following message will be sent to all registered attendees. You may edit it to add the reason for cancellation
			or any other important information: 
		</p>
		<%= form_tag({:action => 'show'}, { :method => :delete, :onSubmit => 'return validateform();' }) %>
			<%= label_tag "custom_message", "Cancellation Message:", :class => 'field-label hidden' %>
			<%= text_area_tag "custom_message", default_cancellation_message(@session), :rows => 10, :cols => 60 %><br/>
			<p class="cancel-session-instructions">The full session details will be included in the email, so you do not need to provide them here. Additionally, a link will be included so that attendees can register for another session.</p>
			<%= submit_tag "Cancel Session" %>
			<%= link_to_function "Don't cancel", "cancel_modal.hide()" %>
		</form>
	</div>
	<script type="text/javascript">
		function validateform() {
			if ($('custom_message').value == "") {
				alert('The cancellation message may not be blank');
				$('custom_message').value = '<%=escape_javascript(default_cancellation_message(@session))%>';
				return false;
			}
			return true;
		}

		var cancel_modal = new modal($('cancel-session-dialog'));
		$('cancel-session-link').observe('click', function() {
			cancel_modal.show();
		});
	</script>
<% end %>
