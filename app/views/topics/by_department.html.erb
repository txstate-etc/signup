<% cache({:action => :by_department, :action_suffix => "#{date_slug}"}, :tag => 'session-info')  do %>
  <% @topics = Topic.upcoming %>
  <% if @topics.count == 0 %>
    <div class="empty-list">
      <p>Sorry, there are no upcoming sessions at this time. Please check again later!</p>
    </div>
  <% else %>
    <% grouped_by_department(@topics) do |department, topics| %>
      <div class="content-section">
        <h2><%= department.name %></h2>
        <ul class="topic-list">
          <% topics.each do |topic| %>
            <% cache(["topics/by_department", topic], :tag => topic.cache_key) do %>
              <li>
                <%= link_to topic.name, topic %>
                <% if topic.upcoming_sessions.present? %>       
                <% session = topic.upcoming_sessions[0] %>
                <div class="session-info">
                  <span class="session-link"><%= link_to_session session %></span>
                  <%= session_site(session) %>
                </div>
                <% end %>
              </li>
            <% end %>
          <% end %>
        </ul>
      </div>
    <% end %>
  <% end %>
<% end %>
